# Aurora Checklist — TESTCASES (минимальная регрессия)

Цель: после любой правки быстро проверить, что **ничего не развалилось**.

## Как тестировать
1) Запусти проект.
2) Открой чек‑лист: `http://127.0.0.1:8000/`.
3) Для каждого кейса: выставь условия → проверь результат справа → скачай Word (если указано).

---

## TC‑00: Smoke‑тест модулей и данных
**Шаги:**
1) Открыть `/`, `/client/`, `/manager/`, `/admin/` (все страницы должны загрузиться).
2) В `/client/` открыть «Матрица услуг» и убедиться, что граф строится.
3) В `/admin/` загрузить данные, изменить, например, `rub_per_point`, сохранить.
4) Перезагрузить `/client/` и `/manager/` и убедиться, что изменение видно в расчёте.

**Ожидаемо:**
- Нет 404 по ассетам.
- «Матрица услуг» открывается и показывает данные.
- Правки из админки сразу отражаются в клиенте и менеджере.

---

## TC‑01: Розница, базовый сценарий
**Шаги:**
1) Сегмент: `Розница`.
2) ККТ: не добавлять.
3) Юрлица: 1.
4) Устройства: 0.

**Ожидаемо:**
- Пакет рассчитан (не «—»).
- Итоговая сумма не отрицательная.
- Word скачивается.

---

## TC‑02: Розница + ККТ
**Шаги:**
1) Сегмент: `Розница`.
2) Нажать `+ Добавить ККТ`, выбрать производителя и модель.

**Ожидаемо:**
- Выпадашки производителя и модели открываются.
- Справа обновляются плашки и расчёт.

---

## TC‑03: Несколько юрлиц
**Шаги:**
1) Любой сегмент.
2) Включить `Несколько юрлиц`.
3) Накрутить `Количество юрлиц` до 3.

**Ожидаемо:**
- Счётчик работает кнопками `−/+`.
- В расчёте появляется доп.услуга за доп.юрлица.

---

## TC‑04: Устройства и Клеверенс
**Шаги:**
1) Любой сегмент.
2) Увеличить `ТСД` до 1.
3) Включить `Клеверенс: коллективная работа`.

**Ожидаемо:**
- Галка доступна только когда ТСД > 0.
- Стоимость лицензий увеличивается.

---

## TC‑05: Производитель — товарные группы ЧЗ
**Шаги:**
1) Сегмент: `Производитель/Импортёр`.
2) В блоке `Продукция (ЧЗ)` выбрать 2–3 категории.

**Ожидаемо:**
- Выбор удобный (поиск/чипы, без «простыни»).
- Категории попадают в текст пресейла.

---

## TC‑06: Word — базовые требования к формату
**Шаги:**
1) Выбрать любой сегмент.
2) Заполнить 1–2 пункта.
3) Скачать Word.

**Ожидаемо:**
- Документ открывается без ошибок.
- Весь текст **Arial 8**.
- В таблице услуг/задач отражаются выбранные услуги (без «левых» заглушек).

---

## TC‑07: Админка — изменение data.json
**Шаги:**
1) Установить токен: `AURORA_ADMIN_TOKEN`.
2) Открыть `/admin`.
3) Нажать `Загрузить data.json`.
4) Поменять, например, `rub_per_point`.
5) Нажать `Сохранить изменения`.

**Ожидаемо:**
- Сохранение проходит (ok=true).
- В `logs/data_changes.log` появляется запись с diff.

---

## TC‑08: 1С — выбор конфигурации и отражение в Word
**Шаги:**
1) Выбрать любой сегмент.
2) В блоке `Учётная система (1С)` выбрать конфигурацию и переключить `Актуальная/Неактуальная`.
3) Скачать Word.

**Ожидаемо:**
- В протоколе заполнения есть строки `1С конфигурация` и `1С актуальная`.
- В блоке «Продукты» внутри ЛТ есть строка `1С: ...`.

---

## TC‑09: Прозрачность расчёта — «Почему такая стоимость?»
**Шаги:**
1) Выбрать сегмент.
2) Включить 2–3 пункта, которые добавляют баллы/лицензии (например: +юрлица, +сканеры, ТСД).
3) Нажать кнопку `Почему такая стоимость?` под «Итого».

**Ожидаемо:**
- Открывается окно.
- В нём есть: выбранные параметры, база пакета, список доп.баллов (с баллами), список лицензий и формула итога.

---

## TC‑10: Матрица услуг — какие правила сработали
**Шаги:**
1) Выбрать сегмент `Опт` (или `Производитель/Импортёр`).
2) Сделать комбинацию, чтобы сработали разные правила:
   - Юрлица: 3 (чтобы были доп.юрлица)
   - Сканеры: 2 (чтобы был доп.сканер)
   - ТСД: 1 (чтобы появились лицензии)
   - (для опта/производства) выключить `ЭДО`.
3) Нажать кнопку `Матрица услуг` под «Итого».

**Ожидаемо:**
- Открывается окно с картой правил.
- Активные правила помечены `✅` и показывают, какие баллы/суммы они добавили.
- Неактивные правила помечены `—`.


---

## TC-11 — Адаптивная сетка: main / extra / result (3 → 2 → 1)
**Цель:** убедиться, что сетка по ТЗ не ломает UX и кнопки.

**Шаги:**
1) Открыть главную страницу на широком экране (десктоп).
2) Проверить: 3 колонки (main / extra / result).
3) Уменьшить ширину окна до ~1300px.
4) Проверить: 2 колонки, справа — «Результат», слева — два чек‑листа (main сверху, extra снизу).
5) Уменьшить до мобильной ширины (<980px).
6) Проверить: 1 колонка, все кнопки и модалки работают.

**Ожидаемый результат:**
- Ничего не перекрывается.
- «Почему такая стоимость?» и «Матрица услуг» открываются корректно.
- Кнопки «Скопировать/Пресейл/Word» остаются видимыми.
- При скролле «Результата» sticky‑блок сверху не просвечивает и не выглядит «наложением».


---

## TC-12 — Popover по кнопке "i" (состав пакета и план Клеверенса)
**Цель:** на ПК подсказка должна появляться по наведению, а на мобильных — открываться по клику.

**Шаги (ПК):**
1) Выбрать сегмент, чтобы был рассчитан пакет.
2) Навести курсор на кнопку **i** у названия пакета.
3) Убедиться, что появилось маленькое окно со списком «что входит».
4) Добавить ТСД > 0 → появится блок выбора плана Клеверенса.
5) Навести на кнопку **i** у плана.

**Ожидаемо (ПК):**
- Popover появляется и исчезает без клика.
- При скролле/resize popover скрывается.

**Шаги (моб/тач):**
1) Тапнуть по **i** у пакета.
2) Тапнуть по **i** у плана Клеверенса.

**Ожидаемо (моб/тач):**
- Открывается модалка с теми же данными.


---

## TC-13 — Админка: табы, справочники, импорт/экспорт, валидация
**Цель:** убедиться, что 90% правок делаются без raw JSON и что сохранение не даёт сохранить явные ошибки.

**Шаги:**
1) Открыть `/admin`.
2) Вставить токен, нажать «Сохранить токен».
3) Нажать «Загрузить data.json».
4) Во вкладке **Основное**: изменить `rub_per_point` и убедиться, что raw JSON (в Advanced) обновился.
5) Во вкладке **Пакеты**:
   - в любом сегменте нажать «+ Добавить пакет»
   - у нового пакета заполнить название и цену
   - нажать «Дублировать»
   - поднять пакет вверх кнопкой «↑»
6) Во вкладке **Справочники**:
   - добавить конфигурацию 1С (ID+Название)
   - добавить план Клеверенса (ID+Название+Описание+includes по строкам)
7) Нажать «Скачать резервную копию» — должен скачаться JSON файл.

**Проверка валидации:**
8) Сделать ошибку: очистить ID у одной 1С конфигурации.
9) Нажать «Сохранить изменения».

**Ожидаемо:**
- Сохранение блокируется и показывает список проблем (что именно заполнить).

**Проверка успешного сохранения:**
10) Исправить ошибку (вернуть ID).
11) Нажать «Сохранить изменения».

**Ожидаемо:**
- Сохранение проходит успешно.
- После перезагрузки `/admin` и «Загрузить data.json» изменения остались.
